'use strict';

module.exports = connect;
connect.connect = connect;

var util = require('util');

// Returns an array [options] or [options, cb]
// It is the same as the argument of Socket.prototype.connect().
function __normalizeConnectArgs(args) {
  var options = {};

  if (typeof(args[0]) == 'object') {
    // connect(options, [cb])
    options = args[0];
  } else if (isPipeName(args[0])) {
    // connect(path, [cb]);
    options.path = args[0];
  } else {
    // connect(port, [host], [cb])
    options.port = args[0];
    if (typeof(args[1]) === 'string') {
      options.host = args[1];
    }
  }

  var cb = args[args.length - 1];
  return typeof(cb) === 'function' ? [options, cb] : [options];
}


function normalizeConnectArgs(listArgs) {
  var args = __normalizeConnectArgs(listArgs);
  var options = args[0];
  var cb = args[1];

  if (typeof(listArgs[1]) === 'object') {
    options = util._extend(options, listArgs[1]);
  } else if (typeof(listArgs[2]) === 'object') {
    options = util._extend(options, listArgs[2]);
  }

  return (cb) ? [options, cb] : [options];
}

function connect(/* [port, host], options, cb */) {
  console.error('dborkan connect called!!!!');
  var args = __normalizeConnectArgs(arguments);
  var options = args[0];
  var cb = args[1];

  // Upgrade the socket to TLS.
  options.socket.secure();

  // invoke the callback async as soon as possible
  setTimeout(cb, 0);

  // return the same socket object as the input
  return options.socket;
}